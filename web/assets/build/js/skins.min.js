var skins={filterText:"",filterAppId:"",finalPrice:0,countSellItems:0,skinsCountUser:0,invAllPrice:0,depositInfo:{},windowWidth:window.innerWidth,finalPriceBl:$("#js-final-value"),finalPriceInput:$("#inventory_itemsValue"),rarity:{"Base Grade":1,"Consumer Grade":2,"Mil-Spec Grade":3,Restricted:4,Covert:5,"Industrial Grade":6,Classified:7},sum:function(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=10*arguments[t];return(e/10).toFixed(2)},toggleType:function(e){var t=this.initObj[e];1==t.type?t.type=2:t.type=1,this.renderItems()},submitForm:function(){var e=this,t=[];$("#skinsSubmit").addClass("clicked");for(p in e.initObj)2==e.initObj[p].type&&t.push({id:e.initObj[p].id,market_hash_name:e.initObj[p].market_hash_name});var s={deposit_id:depositId,items:t};$.ajax({url:Routing.generate("inventory_submit",{_locale:locale})+"?token="+csrfToken,type:"POST",dataType:"json",data:JSON.stringify(s),success:function(t){"success"==t.status?($("#skinsBlLast, #tSent").removeClass("hide"),$("#skinsBl").addClass("hide"),e.initTimer(),e.worker(),$("#confirmTradeLink").attr("href",t.confirm_trade_offer_url),$("#tradeHash").html(t.deposit.trade_hash)):($("#skinsBl").addClass("hide"),$(".skinsFinalFail, .container.oneColl").removeClass("hide"),$("#skinsFinalFail-message").html(t.message))}})},clickItems:function(e){this.toggleType($(e).attr("data-index"))},filterItems:function(e){var t=this;t.filterText=e,t.renderItems()},itemsWrapShowIcons:function(){try{var e=$(".custom-scroll_inner").height()+$(".custom-scroll_inner").scrollTop();if(isNaN(e))throw new Error("bottom line isNan");e+=50;var t=$(".skinsItem").filter(function(){var t=$(this).offset().top-237+100;return t<=e});$(t).each(function(){$(".skinsItem__img__i",$(this)).find("img").length||$(".skinsItem__img__i",$(this)).append($("<img />").attr("src",$(".skinsItem__img__i",$(this)).data("icon")))})}catch(s){console.log("Error in load icons: "+s.toString()),$(".skinsItem").each(function(){$(".skinsItem__img__i",$(this)).find("img").length||$(".skinsItem__img__i",$(this)).append($("<img />").attr("src",$(".skinsItem__img__i",$(this)).data("icon")))})}},renderItems:function(e){var t=this,s="",n="",a="";t.finalPrice=0,t.countSellItems=0,void 0===e&&(e=this.initObj),t.windowWidth>1e3&&$(".skins__items").customScroll("destroy");for(i in e){var o="",l="skinsItem--acceptable",r="";2==e[i].type&&t.windowWidth<1e3&&(o="skinsItem--active"),0==e[i].acceptable&&(l="skinsItem--deceptable",r='<div class="skinsItem__disableBl"></div>');var d,c=0==e[i].acceptable?unacceptableTranslate:e[i].market_name,m='<div class="skinsItem '+o+" "+l+'" data-id='+e[i].id+'" data-index='+i+" data-app_id="+e[i].app_id+">"+r+'<div class="skinsItem__name">'+c+'</div><div class="skinsItem__img"><div class="skinsItem__img__circle" style="border-color: #'+e[i].color+'"></div><div class="skinsItem__img__i" data-icon="'+e[i].icon_url+'100x100"></div></div><div class="skinsItem__price">'+e[i].price+" "+currency+"</div></div>",p=e[i].market_hash_name.toLowerCase();d=null==e[i].market_name?e[i].market_hash_name.toLowerCase():e[i].market_name.toLowerCase();var u=e[i].app_id,h=!1;""!=t.filterText&&(d.indexOf(t.filterText.toLocaleLowerCase())<0&&(h=!0),p.indexOf(t.filterText.toLocaleLowerCase())<0&&(h=!0)),""!=t.filterAppId&&t.filterAppId!=u&&(h=!0),1!=e[i].type||h?2==e[i].type&&(t.windowWidth>1e3?a+=m:s+=m,t.countSellItems++,t.finalPrice=t.sum(t.finalPrice,parseFloat(e[i].price_raw))):1==e[i].acceptable&&(s+=m)}s+=n,$(t.finalPriceInput).val(t.finalPrice),$(t.finalPriceBl).html(parseFloat(t.finalPrice).toFixed(2)+" "+currency),$("#countSellItems").html(t.countSellItems),$(countSellItemsMob).html(t.countSellItems),this.itemsWrap.innerHTML=s,this.itemsWrapSell.innerHTML=a,this.clickableItems=$(".skinsItem.skinsItem--acceptable"),t.countSellItems>0?t.skinsSubmit.classList.remove("disabled"):t.skinsSubmit.classList.add("disabled"),$(this.clickableItems).on("click",function(){t.clickItems(this)}),$("#skinsCountSum").html(parseFloat(t.invAllPrice).toFixed(2)+" "+currency),$("#skinsCountUser").html(t.skinsCountUser),$("#countSellItemsMob").html(t.countSellItems),$("#countSellItems").html(t.countSellItems),t.windowWidth>1e3?$(".skins__items").customScroll():$(".skins__items").customScroll("destroy"),this.itemsWrapShowIcons(),this.itemsWrap.addEventListener("scroll",function(e){e.preventDefault(),e.stopPropagation(),this.itemsWrapShowIcons()}.bind(this))},getTimeRemaining:function(e){var t=Date.parse(e)-Date.parse(new Date),s=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60);return{total:t,minutes:i,seconds:s}},updateClock:function(){var e=this,t=this.getTimeRemaining(this.deadline);timerMin.innerHTML=t.minutes,timerSec.innerHTML=t.seconds,t.total<=0&&(e.worker(),clearInterval(e.timeinterval))},initTimer:function(){var e=this;void 0==$.cookie("date"+depositId)?(this.deadline=new Date,this.deadline.setMinutes(this.deadline.getMinutes()+3),$.cookie("date"+depositId,this.deadline,{expires:this.deadline,path:"/"})):this.deadline=$.cookie("date"+depositId),this.updateClock(),this.timeinterval=setInterval(function(){e.updateClock()},1e3)},changeLang:function(e){window.location.href=location.origin+"/"+e+"/"+location.search},checkSteamStatus:function(){$.ajax({url:Routing.generate("is_steam_rip",{_locale:locale}),type:"GET",complete:function(e){"string"==typeof e.responseJSON.status&&"string"==typeof e.responseJSON.message&&($(".head__steam__circle").addClass("circle__"+e.responseJSON.status),$("#steamStatus").addClass(e.responseJSON.status).text(e.responseJSON.message))}})},worker:function(){$.ajax({url:Routing.generate("check_deposit",{_locale:locale,depositId:depositId}),success:function(e){"show_success"==e.action?($("#js-deposit-amount").text(e.amount),$(".tSent").addClass("hide"),$(".skinsFinalSuccess").removeClass("hide")):"show_fail"==e.action?($(".tSent").addClass("hide"),$(".skinsFinalFail").removeClass("hide"),$("#skinsFinalFail-message").html(e.message)):"show_pending"==e.action&&setTimeout(skins.worker,1e4)}})},loadInventory:function(){var e=this;$.ajax({url:Routing.generate("inventory",{_locale:locale}),type:"GET",success:function(t){"success"==t.status?(skins.responseItems=t.inventory.items,skins.responseItemsValue=t.inventory.itemsValue,e.depositInfo=t.inventory.deposit,$("#confirmTradeLink").attr("href",t.confirm_trade_offer_url),skins.init()):($("#invtLoadErr").html("<p>"+t.message+"</p>").removeClass("hide"),$("#skinsBlPre").addClass("error"))}})},preInit:function(){this.depositInfo.status="undefined"!=typeof depositStatus?depositStatus:null,this.checkSteamStatus(),"new"!=this.depositInfo.status&&"error_inventory"!=this.depositInfo.status||this.loadInventory(),"pending"!=this.depositInfo.status&&"error_bot"!=this.depositInfo.status&&"error_unacceptable_item"!=this.depositInfo.status||this.init()},init:function(){var e=this;if($("#skinsBlPre").hide(),"new"==e.depositInfo.status||"error_inventory"==e.depositInfo.status){$("#skinsBl").removeClass("hide"),e.skinsSubmit=document.getElementById("skinsSubmit"),$(".skins__items").customScroll(),this.itemsWrap=document.getElementById("skinsItemsWrap"),this.itemsWrapSell=document.getElementById("skinsItemsWrapSell");$(".skinsItem");this.initObj={};for(var t=0;t<e.responseItems.length;t++)e.initObj[t]={id:e.responseItems[t].id,icon_url:e.responseItems[t].icon_url,market_name:e.responseItems[t].market_name,market_hash_name:e.responseItems[t].market_hash_name,price:e.responseItems[t].price,price_raw:e.responseItems[t].price_raw,color:e.responseItems[t].color,rarity:e.responseItems[t].rarity,type:e.responseItems[t].type,app_id:e.responseItems[t].app_id,acceptable:e.responseItems[t].acceptable},e.responseItems[t].acceptable&&e.skinsCountUser++,e.invAllPrice=e.responseItemsValue;e.renderItems();var s;window.addEventListener("resize",function(){clearInterval(s),s=setTimeout(function(){e.windowWidth=window.innerWidth,e.renderItems()},500)}),document.getElementById("skinsSearch").oninput=function(){this.value.length>0?$("label[for=skinsSearch]").hide():$("label[for=skinsSearch]").show(),e.filterItems(this.value)},document.getElementById("filterByAppId").addEventListener("change",function(t){e.filterAppId=t.target.value,e.filterItems(e.filterText)})}else"pending"==e.depositInfo.status?(e.initTimer(),e.worker(),$("#skinsBlLast, #tSent").removeClass("hide")):"completed"==e.depositInfo.status?$("#skinsBlLast, #skinsFinalSuccess").removeClass("hide"):"error_bot"!=e.depositInfo.status&&"error_unacceptable_item"!=e.depositInfo.status||$("#skinsBlLast, #skinsFinalFail").removeClass("hide")}};$(document).ready(skins.preInit());var modaln={open:function(e,t){if($("#last_popup").length&&e.indexOf("modal-task-pop")<0&&e.indexOf("modal-result-task")<0&&e.indexOf("modal-semenih")<0&&(e="#modal-semenih2"),$("body").css("top",-RealScroll),"#modal-result-task"==e){var s=$(t).parents("[data-avatar]");$("#modal-result-task .name span").text(s.attr("data-name")),$("#modal-result-task .modal-result-task-name").attr("href",s.attr("data-link")),$vote_btn=$("#modal-result-task .result-task-vote-btn"),$vote_btn.attr("data-id",s.attr("data-id"));var i=s.attr("data-user-voted");"1"==i?($vote_btn.find("span").html("Вы уже голосовали"),$vote_btn.addClass("cant_vote")):($vote_btn.find("span").html("Проголосуй"),$vote_btn.removeClass("cant_vote")),$("#modal-result-task .description").text(s.attr("data-text")),$("#modal-result-task .image img").attr("src",s.attr("data-photo")),$("#modal-result-task .likes").html("<i></i> "+s.attr("data-likes")),$("#modal-result-task .modal-result-task-name .img").css("background-image","url("+s.attr("data-avatar")+")")}"#modal-delete"==e&&$("#modal-delete a").attr("href","/lk?delete_post="+$(t).attr("data-id-delete")),$("body").addClass("modalnOpened"),$("html").addClass("fixed"),$(e).show()},close:function(e,t){bodyElem.css("top",0),bodyElem.scrollTop(RealScroll),$(e.target).closest(".modaln-content").length||($("body").removeClass("modalnOpened"),$("html").removeClass("fixed"),$(t).hasClass("modaln")?$(t).hide():$(t).parents(".modaln").hide())}},RealScroll=0,bodyElem=$("body");$(window).scroll(function(){CurrentScroll=$(window).scrollTop(),0!==CurrentScroll&&(RealScroll=CurrentScroll)}),$(document).on("click",".modaln .close, .btn.back, .modaln .btn-close",function(){$(this).parents(".modaln").hide(),bodyElem.removeClass("modalnOpened"),bodyElem.css("top",0),bodyElem.scrollTop(RealScroll)}),$(document).on("click","[data-modal]",function(){modaln.open("#"+$(this).attr("data-modal-name"),this)}),$(document).on("click",".modal",function(e){$(e.target).closest(".modal-content").length||($(".modal").hide(),$("body").removeClass("modalnOpened"),$("html").removeClass("fixed"))}),$(document).on("click",".close",function(e){$(".modal").hide(),$("body").removeClass("modalnOpened"),$("html").removeClass("fixed")});